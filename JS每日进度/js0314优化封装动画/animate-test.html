<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>动画作业</title>
		<style type="text/css">
			.box{
				float: right;
				width: 100px;
				height: 100px;
				border: 1px solid black;
			}
			.box .inner{
				float: right;
				width: 0;
				display: none;
				border: 1px solid black;
			}
		</style>
		<!--<script src="common.js"></script>-->
	</head>
	<body>
		<div class="box">
			<div class="inner"></div>
		</div>
		<script>
			var box=getClass('box')[0];
			var inner=getClass('inner')[0];
			console.log();
			var flag=false;
			box.onclick=function(){
				if(flag=!flag){
					inner.style.display='block';
					animate(inner,{
						height:80,
						marginTop:120
					},function(){
						animate(inner,{
						width:300
					});
					});
				}else{
					animate(inner,{
						width:0
					},function(){
						animate(inner,{
						height:0,
						marginTop:0
					},function(){
						inner.style.display='none';
					});
					});				
				}	
			};
			function getClass(classN){
				var arr = [];
				var elNode = document.getElementsByTagName('*');
				for(var i = 0;i < elNode.length;i ++){
					if(elNode[i].className.match(new RegExp('(^|\\s)' + classN + '($|\\s)'))){
						arr.push(elNode[i]);
					}
				}
				return arr;
			}
			function getStyle(el,attr){
				if(getComputedStyle){
					return getComputedStyle(el,null)[attr];
				}else{
					return el.currentStyle[attr];
				}
			}
			function animate(el,obj,time,callback){
				if(typeof time === 'function' || time=== undefined){
					callback=time;
					time=300;
				}
				var t = 16;
				var start = {};
				for(var i in obj){
					start[i] = parseFloat(getStyle(el,i));
				}
				clearInterval(el.timer);
				el.timer = setInterval(function(){
					var flag = true;
					for(var i in obj){
						var attr = i;
						var target = obj[i];
						var current = parseFloat(getStyle(el,attr));
						var step = (target - start[i]) / time * t;
						if(step >= 0 && current >= (target - step) || step <= 0 && current <= (target - step)){
							el.style[attr] = target + 'px';
						}else{
							flag = false;
							el.style[attr] = current + step + 'px';
						}
					}
					if(flag){
						clearInterval(el.timer);
						callback && callback.call(el);
					}
				},t);
			}
		</script>
	</body>
</html>
