<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>邮箱自动补全</title>
		<style type="text/css">
			/**{
				margin: 0;
				padding: 0;
			}*/
			.box{
				width: 400px;
				height: 40px;
				border: 1px solid black;
				margin: auto;
				position: relative;
				cursor: pointer;
			}
			.box input{
				width: 100%;
				height: 100%;
				border: none;
				padding: 0;
				text-indent: 10px;
				font-size: 16px;
			}
			.box .wrap{
				position: absolute;
				top: 40px;
				left: -1px;
				width: 100%;
				text-indent: 10px;
				border: 1px solid black;
				display: none;
			}
			.box .wrap .item{
				height: 30px;
				line-height: 30px;
			}
			.box .wrap .item.on{
				background-color: rgba(255,0,0,.5);
			}
		</style>
		<script src="common.js"></script>
	</head>
	<body>
		<div class="box">
			<input type="text" />
			<div class="wrap">
				<div class="item on"><span></span>@qq.com</div>
				<div class="item"><span></span>@sina.com</div>
				<div class="item"><span></span>@yahoo.com</div>
				<div class="item"><span></span>@126.com</div>
				<div class="item"><span></span>@163.com</div>
			</div>
		</div>
		<script>
			//获取元素，设置全局变量
			var inp = document.querySelector('input');
			var wrap = document.querySelector('.box .wrap');
			var item = document.querySelectorAll('.box .wrap .item');
			var span = document.querySelectorAll('.box .wrap .item span');
			var len =item.length;
			var num = 0;
			//获取焦点，隐藏内容出现
			inp.onfocus = display;
			//判断是否隐藏
			function display(){
				if(inp.value.indexOf('@') != -1){
					wrap.style.display = 'none';
				}else{
					wrap.style.display = 'block';
				}	
			}	
			//input框输入内容
			inp.onkeyup = function(){
				//判断是否隐藏
				display();
				//隐藏内容实时更新
				for(var i=0;i<len;i++){
					span[i].innerHTML = this.value;
				}	
			}	
			//遍历选项
			for(var i=0;i<len;i++){
				item[i].index = i;
				item[i].onmouseover = function(){
					num = this.index;
					setItem();
				}
				//点击任一列表项完成输入
				item[i].onmousedown = function(){
//					inp.value = item[num].innerHTML.replace(/<\/?span>/ig,'');
					inp.value = item[num].childNodes[0].innerHTML + item[num].childNodes[1].nodeValue;
				}
			}
			//设置选项
			function setItem(){
				var sib = getSibling(item[num]);
				for(var i=0;i<sib.length;i++){
					removeClass(sib[i],'on');
				}
				addClass(item[num],'on')
			}
			//键盘选择确定输入项
			inp.onkeydown = function(evt){
				var e = evt || window.event;
				switch(e.keyCode){
					case 38:
					num = num <= 0 ? 0 : --num;
					setItem();
					break;
					case 40:
					num = num >= len-1 ? len-1 : ++num;
					setItem();
					break;
					case 13:
					if(inp.value.indexOf('@') == -1){
						wrap.style.display = 'none';
						inp.value = item[num].innerHTML.replace(/<\/?span>/ig,'');
					}
					break;
				}
			}
			//输入完成，隐藏内容消失
			inp.onblur = function(){
				wrap.style.display = 'none';
			}
		</script>
	</body>
</html>
