<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>贪吃蛇</title>
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
			}
			#box{
				width: 500px;
				height: 500px;
				border: 1px solid black;
				position: relative;
				margin: auto;
			}
			.snake{
				position: absolute;
				width: 10px;
				height: 10px;
				background-color: red;
			}
			.food{
				position: absolute;
				width: 10px;
				height: 10px;
				background-color: green;
			}
		</style>
	</head>
	<body>
		<div id="box">
			<div class="snake" style="left: 0;top: 0;"></div>
			<div class="snake" style="left: 10px;top: 0;"></div>
			<div class="snake" style="left: 20px;top: 0;"></div>
			<div class="food"></div>
		</div>
		<script>
			var box = document.getElementById('box');
			var snake = document.querySelectorAll('.snake');
			var food = document.querySelector('.food');
			randomFood();
			//随即生成食物
			function randomFood(){
				foodX = Math.floor(Math.random()*50)*10;
				foodY = Math.floor(Math.random()*50)*10;
				food.style.left = foodX + 'px';
				food.style.top = foodY + 'px';
			}
			//使用数组记录snake位置，蛇的长度与数组长度相同
			var snakeArr = [[0,0],[10,0],[20,0]];
			var code = 0;
			var direction = 39;//控制方向
			var t = 500;
			var num = 0;
			document.onkeydown = function(evt){
				var e = evt || window.event;
//				if([37,38,39,40].indexOf(e.keyCode) != -1){
//					code = e.keyCode;
//				}	
				direction = e.keyCode;
			}
			move();
			function move(){
				setTimeout(function(){
					//解决蛇头反走问题
					if(code != 37 && direction == 39 || code != 38 && direction == 40 || code != 39 && direction == 37 || code != 40 && direction ==38){
						code = direction;
					}
					//记录蛇尾坐标
					var snakeTailX = snakeArr[0][0];
					var snakeTailY = snakeArr[0][1];
					//控制蛇身
					for(var i=0;i<snake.length-1;i++){
						snakeArr[i][0] = snakeArr[i+1][0];
						snakeArr[i][1] = snakeArr[i+1][1];
					}
					//控制蛇头
					var snakeHead = snakeArr[snake.length-1];
					if(code==37){
						snakeHead[0] -= 10;
					}else if(code == 38){
						snakeHead[1] -= 10;
					}else if(code == 39){
						snakeHead[0] += 10;
					}else if(code == 40){
						snakeHead[1] += 10;
					}
					//蛇头吃到自身，结束游戏
					for(var i=0;i<snake.length-1;i++){
						if(snakeHead[0] == snakeArr[i][0] && snakeHead[1] == snakeArr[i][1]){
							alert('GameOver!');
							location.reload();
						}
					}
					//蛇头超出边界，结束游戏
					if(snakeHead[0] < 0 || snakeHead[1] < 0 || snakeHead[0] > 490 || snakeHead[1] > 490){
						alert('GameOver!');
						location.reload();
					}
					//吃到食物后变化
					if(snakeArr[snake.length-1][0] == foodX && snakeArr[snake.length-1][1] == foodY){
						num ++;
						randomFood();
						snakeArr.unshift([snakeTailX,snakeTailY]);
						var snakeTail = document.createElement('div');
						snakeTail.className = 'snake';
						box.appendChild(snakeTail);
						if(t>100){
							t -= 10;
						}	
					}
					snake = document.querySelectorAll('.snake');
					for(var i=0;i<snake.length;i++){
						snake[i].style.left = snakeArr[i][0] + 'px';
						snake[i].style.top = snakeArr[i][1] + 'px';
					}
					move();
				},t)	
			}
				
			
		/*	//使用数组记录snake位置
			snakeArr = [[0,0],[10,0],[20,0]];
			var len = snake.length;
			document.onkeydown = function(evt){
				var e = evt || window.event;
				switch(e.keyCode){
					case 37://蛇身走完蛇头再动，保持动作连贯
					for(var i=0;i<len-1;i++){
						snakeArr[i][0] = snakeArr[i+1][0];
						snakeArr[i][1] = snakeArr[i+1][1];
					}
					snakeArr[len-1][0] -= 10;
					break;
					case 38:
					for(var i=0;i<len-1;i++){
						snakeArr[i][0] = snakeArr[i+1][0];
						snakeArr[i][1] = snakeArr[i+1][1];
					}
					snakeArr[len-1][1] -= 10;
					break;
					case 39:
					for(var i=0;i<len-1;i++){
						snakeArr[i][0] = snakeArr[i+1][0];
						snakeArr[i][1] = snakeArr[i+1][1];
					}
					snakeArr[len-1][0] += 10;
					break;
					case 40:
					for(var i=0;i<len-1;i++){
						snakeArr[i][0] = snakeArr[i+1][0];
						snakeArr[i][1] = snakeArr[i+1][1];
					}
					snakeArr[len-1][1] += 10;
					break;
				}
				for(var i=0;i<len;i++){
					snake[i].style.left = snakeArr[i][0] + 'px';
					snake[i].style.top = snakeArr[i][1] + 'px';
				}
			}
			*/
			/*document.onkeydown = function(evt){
				var e = evt || window.event;
				
				switch(e.keyCode){
					case 37://蛇身走完蛇头再动，保持动作连贯
					snakeBody();
					snake[len-1].style.left = parseInt(snake[len-1].style.left) - 10 + 'px';
					break;
					case 38:
					snakeBody();
					snake[len-1].style.top = parseInt(snake[len-1].style.top) - 10 + 'px';
					break;
					case 39:
					snakeBody();
					snake[len-1].style.left = parseInt(snake[len-1].style.left) + 10 + 'px';
					break;
					case 40:
					snakeBody();
					snake[len-1].style.top = parseInt(snake[len-1].style.top) + 10 + 'px';
					break;
				}
			}
			//蛇身动作
			function snakeBody(){
				for(var i=0;i<len-1;i++){
					snake[i].style.left = snake[i+1].style.left;
					snake[i].style.top = snake[i+1].style.top;
				}
			}*/
		</script>
	</body>
</html>
